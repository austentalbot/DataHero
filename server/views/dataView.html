<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular.min.js"></script>
</head>
<body>
    <h4>Employee salary data</h4>
    <div ng-app='dh' ng-controller='load' ng-init='loadContacts()'>
      <ul ng-repeat='contact in contacts' repeat-complete>
        <li class='user' data-firstname='{{contact.firstname}}' data-lastname='{{contact.lastname}}'>{{contact.lastname}}, {{contact.firstname}}</li>
      </ul>

    </div>

</body>
<script>
  var app = angular.module('dh', []);

  app.controller('load', function($http, $scope, $rootScope) {


    $scope.contacts = [];
    $scope.loadContacts = function() {
      $http({
        url: 'http://127.0.0.1:6474/employees',
        method: 'GET'
      }).success(function(data) {
        console.log(data);     
        $scope.contacts = data;
      });
    };

    $rootScope.getSalary = function(firstName, lastName) {
      return $http({
        url: 'http://127.0.0.1:6474/salaryHistory',
        method: 'GET',
        data: {firstName: firstName, lastName: lastName}
      });
    };

  });

  //add event listener after users have been loaded
  app.directive('repeatComplete', function($rootScope) {
    return function(scope, element, attrs) {
      if (scope.$last){
        $('.user').on('click', function() {
          $rootScope.getSalary(this.getAttribute('data-firstname'), this.getAttribute('data-lastname'))
          .success(function(data) {
            console.log(data);
          });
        });
      }
    };
  });

</script>
</html>
